<!DOCTYPE html>
<html lang="en">
  <head>
    <base href="/MySqlConnector/" />
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Documentation for MySqlConnector: an Async MySQL Driver for .NET and .NET Core">
    <meta name="author" content="MySqlConnector Authors">
    
    <link rel="apple-touch-icon" sizes="57x57" href="img/icons/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="img/icons/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="img/icons/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="img/icons/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="img/icons/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="img/icons/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="img/icons/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="img/icons/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="img/icons/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192"  href="img/icons/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="img/icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="img/icons/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="img/icons/favicon-16x16.png">
    <link rel="manifest" href="img/icons/manifest.json">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/ms-icon-144x144.png">
    <meta name="theme-color" content="#ffffff">
    

    <meta name="generator" content="Hugo 0.32" />
    
    <title>MySqlConnector - Best Practices</title>

    <script src="https://code.jquery.com/jquery-1.8.0.js"></script>
    <script src="https://code.jquery.com/ui/1.8.23/jquery-ui.js"></script>
    <script src="https://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/js/bootstrap.min.js"></script>
    <link href="https://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/css/bootstrap-combined.min.css" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="css/style.css" />
    <link rel="stylesheet" type="text/css" href="assets/prism/css/prism.css" />
  </head>

  <body>

    <div class="container">
        <div class="masthead">
            <ul class="nav nav-pills pull-right">
            <li><a href="https://github.com/mysql-net/MySqlConnector/">GitHub</a></li>
            </ul>
            <h3 class="muted"><a href="index.html">MySqlConnector</a></h3>
        </div>
        <hr />
        <div class="row">
            <div class="span9" id="main">




<h1 id="best-practices">Best Practices</h1>

<h2 id="asynchronous-operation">Asynchronous Operation</h2>

<p>MySqlConnector is fully asynchronous, supporting the async ADO.NET methods added in .NET 4.5 without blocking
or using <code>Task.Run</code> to run synchronous methods on a background thread. Programmers implementing MySqlConnector
should be familiar with <a href="https://msdn.microsoft.com/en-us/magazine/jj991977.aspx">Async/Await - Best Practices in Asynchronous Programming</a>.</p>

<h3 id="always-use-async-when-possible">Always Use Async when possible</h3>

<table class="table table-bordered table-head-centered" style="max-width: 650px">
  <thead>
    <th style="width:30%">ADO.NET Class</th>
    <th class="alert-success" style="width:40%">Asynchronous Method<br />(always use when possible)</th>
    <th class="alert-danger" style="width:30%">Synchronous Method<br />(avoid when possible)</th>
  </thead>
  <tr>
    <td rowspan="2" style="vertical-align:middle">
      <a href="https://docs.microsoft.com/en-us/dotnet/core/api/system.data.common.dbconnection">DbConnection</a>
    </td>
    <td>OpenAsync</td>
    <td>Open</td>
  </tr>
  <tr>
    <td>
      <span class="text-danger">*</span><a href="api/mysql-connection">MySqlConnection</a>.BeginTransactionAsync
    </td>
    <td>BeginTransaction</td>
  </tr>
  <tr>
    <td rowspan="3" style="vertical-align:middle">
      <a href="https://docs.microsoft.com/en-us/dotnet/core/api/system.data.common.dbcommand">DbCommand</a>
    </td>
    <td>ExecuteNonQueryAsync</td>
    <td>ExecuteNonQuery</td>
  </tr>
  <tr>
    <td>ExecuteReaderAsync</td>
    <td>ExecuteReader</td>
  </tr>
  <tr>
    <td>ExecuteScalarAsync</td>
    <td>ExecuteScalar</td>
  </tr>
  <tr>
    <td rowspan="2" style="vertical-align:middle">
      <a href="https://docs.microsoft.com/en-us/dotnet/core/api/system.data.common.dbdatareader">DbDataReader</a>
    </td>
    <td>NextResultAsync</td>
    <td>NextResult</td>
  </tr>
  <tr>
    <td>ReadAsync</td>
    <td>Read</td>
  </tr>
  <tr>
    <td rowspan="2" style="vertical-align:middle">
      <a href="https://docs.microsoft.com/en-us/dotnet/core/api/system.data.common.dbtransaction">DbTransaction</a>
    </td>
    <td>
      <span class="text-danger">*</span><a href="api/mysql-transaction">MySqlTransaction</a>.CommitAsync
    </td>
    <td>Commit</td>
  </tr>
  <tr>
    <td>
      <span class="text-danger">*</span><a href="api/mysql-transaction">MySqlTransaction</a>.RollbackAsync
    </td>
    <td>Rollback</td>
  </tr>
</table>

<p><span class="text-danger">*</span>Async Transaction methods are not part of ADO.NET, they are provided by
MySqlConnector to allow database code to remain fully asynchronous.</p>

<h3 id="exceptions-dbdatareader-getfieldvalueasync-and-isdbnullasync">Exceptions: DbDataReader.GetFieldValueAsync and IsDBNullAsync</h3>

<p>Once <code>DbDataReader.ReadAsync</code> (or <code>DbDataReader.Read</code>) has returned <code>true</code>, the full contents of the current
row will be in memory. Calling <code>GetFieldValue&lt;T&gt;</code> will return the value immediately (without blocking on I/O).
It will have higher performance than <code>GetFieldValueAsync&lt;T&gt;</code> because it doesn&rsquo;t have to allocate a <code>Task&lt;T&gt;</code>
to store the result. There is no performance benefit to using the <code>DbDataReader.GetFieldValueAsync&lt;T&gt;</code> method.</p>

<p>Similarly, prefer to call <code>IsDBNull</code> instead of <code>IsDBNullAsync</code>; the information is already available and
<code>IsDBNull</code> can return it immediately. (The async performance penalty isn&rsquo;t quite as bad because <code>IsDBNullAsync</code>
uses cached <code>Task&lt;bool&gt;</code> objects for its <code>true</code> and <code>false</code> return values.)</p>

<h3 id="example-console-application">Example Console Application</h3>

<p>In order to get the full benefit of asynchronous operation, every method in the call stack that eventually calls
MySqlConnector should be implemented as an async method.</p>

<p>Example assumes a <a href="overview/configuration">configured AppDb</a> object in the <code>MySqlConnector.Examples</code> namespace.</p>

<pre><code class="language-csharp">using System.Threading.Tasks;
using System.Collections.Generic;

namespace MySqlConnector.Examples
{
    public class Program
    {
        public static async Task Main(string[] args)
        {
            var tasks = new List&lt;Task&gt;();
            for (var i=0; i&lt;100; i++)
            {
                tasks.Add(Controllers.SleepOne());
            }
            // these 100 queries should all complete in around
            // 1 second if &quot;Max Pool Size=100&quot; (the default)
            await Task.WhenAll(tasks);
        }
    }

    public class Controllers
    {
        public static async Task SleepOne()
        {
            using (var db = new AppDb())
            {
                await db.Connection.OpenAsync();
                using (var cmd = db.Connection.CreateCommand())
                {
                    cmd.CommandText = @&quot;SELECT SLEEP(1)&quot;;
                    await cmd.ExecuteNonQueryAsync();
                }
            }
        }
    }
}
</code></pre>

<h2 id="synchronous-operation">Synchronous Operation</h2>

<div class="alert alert-warning">
  Using Synchronous Methods can have adverse effects on the managed thread pool and cause slowdowns or lock-ups
  if not properly tuned. The recommended approach is to use all Asynchronous Methods.
</div>

<p>If you must use synchronous methods, ensure that your thread pool is at least the size of the number of
concurrent connections you plan to support. For example, if you are creating a web server using
synchronous methods that needs to support serving 500 Requests Per Second, set the minimum thread
pool size to 500.</p>

<p>Example <code>csproj</code> configuration:</p>

<pre><code class="language-xml">&lt;PropertyGroup&gt;
  &lt;ServerGarbageCollection&gt;true&lt;/ServerGarbageCollection&gt;
  &lt;ConcurrentGarbageCollection&gt;true&lt;/ConcurrentGarbageCollection&gt;
  &lt;ThreadPoolMinThreads&gt;500&lt;/ThreadPoolMinThreads&gt;
&lt;/PropertyGroup&gt;
</code></pre>


        </div>
        <div class="span3">
    <ul class="nav nav-list" id="menu">

        
        <li class="nav-header">
            <a href="">Home</a>
        </li>

        

        
        <li class="nav-header">
            Getting Started
        </li>

        
        <li>
            <a href="/MySqlConnector/overview/installing/">Installing</a>
        </li>
        
        <li>
            <a href="/MySqlConnector/overview/dbproviderfactories/">DbProviderFactories</a>
        </li>
        
        <li>
            <a href="/MySqlConnector/overview/known-issues/">Known Issues</a>
        </li>
        
        <li>
            <a href="/MySqlConnector/overview/version-history/">Version History</a>
        </li>
        
        <li>
            <a href="/MySqlConnector/overview/configuration/">Configuration</a>
        </li>
        
        <li>
            <a href="/MySqlConnector/overview/logging/">Logging</a>
        </li>
        
        <li>
            <a href="/MySqlConnector/overview/use-with-orms/">Use with ORMs</a>
        </li>
        

        
        <li class="nav-header">
            <a href="/MySqlConnector/connection-options/">Connection Options</a>
        </li>

        

        
        <li class="nav-header">
            Tutorials
        </li>

        
        <li>
            <a href="/MySqlConnector/tutorials/basic-api/">Basic API</a>
        </li>
        
        <li>
            <a href="/MySqlConnector/tutorials/best-practices/">Best Practices</a>
        </li>
        
        <li>
            <a href="/MySqlConnector/tutorials/migrating-from-connector-net/">Migrating from Connector/NET</a>
        </li>
        
        <li>
            <a href="/MySqlConnector/tutorials/net-core-mvc/">Use with .NET Core MVC</a>
        </li>
        

        
        <li class="nav-header">
            API
        </li>

        
        <li>
            <a href="/MySqlConnector/api/mysql-connection/">MySqlConnection</a>
        </li>
        
        <li>
            <a href="/MySqlConnector/api/mysql-command/">MySqlCommand</a>
        </li>
        
        <li>
            <a href="/MySqlConnector/api/mysql-data-reader/">MySqlDataReader</a>
        </li>
        
        <li>
            <a href="/MySqlConnector/api/mysql-transaction/">MySqlTransaction</a>
        </li>
        

        
        <li class="nav-header">
            Troubleshooting
        </li>

        
        <li>
            <a href="/MySqlConnector/troubleshooting/connection-reuse/">Connection Reuse</a>
        </li>
        
        <li>
            <a href="/MySqlConnector/troubleshooting/transaction-usage/">Transaction Usage</a>
        </li>
        
        <li>
            <a href="/MySqlConnector/troubleshooting/load-data-local-infile/">Load Data Local Infile</a>
        </li>
        

        
    </ul>
</div>

      </div>
    </div>

    
    <script type="text/javascript" src="assets/prism/js/prism.js"></script>
  </body>
</html>

